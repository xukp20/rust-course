## 3. Rust高级进阶

### 3.1 生命周期

#### 3.1.1 认识生命周期

函数参数中的生命周期标注，表示的是 'a 不超过参数的实际生命周期，比如x, y的生命周期标注均为'a，则'a应取x, y中比较小的生命周期为实际的值

```rust
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() {
        x
    } else {
        y
    }
}
```

longest返回的引用的生命周期为x, y中生命周期较小者



如果一个函数返回了引用类型，那么它的生命周期要么来自函数参数，要不来自函数内部的新建局部变量

- 后者则一定会编译出错，因为临时变量在离开作用域之后就失效了，引用产生悬垂引用； 这种情况应当返回临时变量本身，进行所有权的转移，而非返回引用



##### 结构体的生命周期

结构体名称后面声明生命周期，其中的引用字段声明生命周期

结构体有效的前提应当是其引用字段均有效，则结构体的生命周期由其中标注了相同生命周期符号的引用字段的生命周期交集决定

###### 生命周期约束语法

使用 ：约束多个参数的生命周期的大小关系

```rust
impl<'a: 'b, 'b> ImportantExcerpt<'a> {
    fn announce_and_return_part(&'a self, announcement: &'b str) -> &'b str {
        println!("Attention please: {}", announcement);
        self.part
    }
}
```

表示 a的生命周期至少比b大



##### 静态生命周期 

'static 声明静态生命周期，与函数的生存时间一样长